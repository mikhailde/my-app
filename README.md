# CI/CD Пайплайн для Приложения "Hello, World!" на Kubernetes

Этот репозиторий демонстрирует процесс создания и оптимизации CI/CD пайплайна для Python веб-приложения "Hello, World!" на Flask, развернутого в кластере Kubernetes (Minikube). Проект использует GitLab CI/CD для автоматизации процессов сборки, тестирования и развертывания, а также Prometheus и Grafana для мониторинга. Для управления инфраструктурой используется Terraform, а Flagger обеспечивает canary deployments.

---

## Содержание
1. [Архитектура](#архитектура)
2. [Оптимизации](#оптимизации)
3. [Инструкция по запуску](#инструкция-по-запуску)
4. [Результаты оптимизации](#результаты-оптимизации)
5. [Дальнейшие улучшения](#дальнейшие-улучшения)
6. [Используемые технологии](#используемые-технологии)
7. [Контакты](#контакты)

---

## Архитектура

![Архитектура](https://github.com/user-attachments/assets/6a97123b-e219-4e91-aaca-8504b6eaeaa0)

* **Приложение:** Простое Flask-приложение, возвращающее сообщение "Hello, World!".
* **Docker:** Контейнеризация приложения для переносимости и упрощения деплоя.
* **Kubernetes (Minikube):** Запуск кластера для локального тестирования.
* **Helm:** Управление релизами приложения в Kubernetes.
* **GitLab CI/CD:** Автоматизация сборки, тестирования и деплоя.
* **Prometheus и Grafana:** Мониторинг и визуализация метрик.
* **Terraform:** Инфраструктура как код (IaC) для управления ресурсами.
* **Flagger:** Постепенное развертывание (canary) для минимизации рисков.

## Оптимизации

Для повышения производительности и стабильности пайплайна реализованы следующие оптимизации:

- **Многоступенчатая сборка Docker:** Уменьшает итоговый размер образа и ускоряет развертывание (см. `Dockerfile`).
- **Кэширование зависимостей Python:** Ускоряет сборку за счёт сохранения зависимостей между запусками пайплайна (см. `.gitlab-ci.yml`).
- **Параллелизация тестов:** Сокращает общее время тестирования путём параллельного запуска тестов (см. `.gitlab-ci.yml`).
- **Инфраструктура как код (Terraform):** Автоматизирует управление Minikube и упрощает развертывание приложения (см. `terraform/main.tf`).
- **Canary Deployments с Flagger:** Обеспечивает безопасный и постепенный деплой обновлений (см. `k8s/canary.yaml`).

## Инструкция по запуску

### Предварительные требования
- Установленные инструменты: `kubectl`, `helm`, `docker`, `terraform`, `minikube`.
- Аккаунт на GitLab для работы с CI/CD.
- Запущенный Minikube:  
   ```bash
   minikube start
   ```

### Шаги

1. **Клонирование репозитория**
   ```bash
   git clone https://gitlab.com/mikhailde/my-app.git
   ```

2. **Развертывание инфраструктуры**
   ```bash
   cd terraform
   terraform init
   terraform apply -auto-approve
   ```
   Настройте переменные в `terraform/variables.tf` для адаптации под ваш кластер.

3. **Настройка GitLab CI/CD**
   - Создайте новый проект на GitLab и привяжите его к репозиторию.
   - Добавьте переменные окружения для CI/CD пайплайна в GitLab.

4. **Запуск пайплайна**
   - Закоммитьте изменения и запушьте их в репозиторий. Пайплайн запустится автоматически.

5. **Мониторинг и визуализация метрик**
   - Импортируйте дашборды из папки `grafana` в Grafana.
   - Настройте Prometheus как источник данных в Grafana для отслеживания метрик.

## Результаты оптимизации

| Метрика               | До оптимизации | После оптимизации | Улучшение |
|-----------------------|----------------|-------------------|-----------|
| Время выполнения      | 3м 39с        | 2м 06с           | **-44%**  |
| Время сборки          | 2м 50с        | 1м 19с           | **-52%**  |
| Время тестирования    | 22с           | 20с              | **-9%**   |
| Время развертывания   | 26с           | 25с              | **-4%**   |
| Размер Docker образа  | 145 МБ        | 140 МБ           | **-3%**   |

Оптимизации значительно ускорили сборку и параллельное тестирование, что улучшило производительность пайплайна.

## Дальнейшие улучшения

- **Добавить интеграционные и E2E тесты** для повышения надежности тестирования.
- **Настроить автоматический деплой в staging и production** для бесперебойного процесса CI/CD.
- **Применить A/B тестирование** как продвинутую стратегию canary deployments.
- **Внедрить сканирование безопасности** для анализа уязвимостей в пайплайне.

## Используемые технологии

- **Языки и фреймворки:** Python, Flask
- **Контейнеризация:** Docker
- **Оркестрация:** Kubernetes, Minikube
- **Пакетный менеджмент и деплой:** Helm
- **CI/CD:** GitLab CI/CD
- **Мониторинг:** Prometheus, Grafana
- **Управление инфраструктурой:** Terraform
- **Canary deployments:** Flagger
- **Тестирование:** Unittest

## Контакты

* **Email:** mshchannikov@yandex.ru
* **Telegram:** [@qumav](https://t.me/qumav)
* **GitHub:** [https://github.com/mikhailde](https://github.com/mikhailde)
